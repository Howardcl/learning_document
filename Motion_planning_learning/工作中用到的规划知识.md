# 1.汽车横纵向控制

车辆的自动驾驶功能主要由纵向运动控制和横向运动控制共同实现,，然而, 对车辆的纵向和横向运动进行单独控制可能会造成 整车运动性能的相互干涉和冲突, 降低整车控制系统的控制精度和主动安全性。因此, 根据车辆自动驾驶过程的整体性能要求, 设计纵向和横向运动综合控制系统, 协调各方向上的运动性能已经成为 车辆自动驾驶面临的重要任务之一。

# 2.汽车可行驶区域生成

**环境分解技术：**以更高的分辨率对空间进行分析，包括voronoi图，占用栅格和状态网格表示。

**Voronoi图：**

通过最大化汽车与周围障碍物之间的距离来生成路径。Voronoi图典型的应用场景是静态环境下的（如停车场）下的规划。

此外，Voronoi图本身不适合公路路径规划，因为汽车导航的Voronoi边缘可能不连续。

**占用栅格：**

将状态空间划分为网格，网格中每个单元格都代表被占用的概率。

**状态网格法：State Lattice**

可视为网格生成的过程。

**驾驶通道法**：代表了一个连续的无碰撞空间，受到道路和车道边界以及其他障碍物的限制，汽车将会在其中行驶。

# 3.汽车局部轨迹规划



局部轨迹生成的目的是生成由一系列轨迹点所定义的轨迹。每个轨迹点都分配了一个时间戳和速度，让一条曲线与这些轨迹点拟合，生成轨迹的几何表征，移动的障碍物可能会暂时阻挡部分路段，路段的每个轨迹点都有一个时间戳，将时间戳与预测模块的输出结合起来，以确保汽车在通过时轨迹上的每个点都未被占用。这些时间戳创建了一个三维轨迹。



直接构造法和路径-速度分解法是常见的局部轨迹生成方法。

==**直接构造法**==：构造汽车后轴中心坐标关于时间的函数。该函数可使用5次多项式，构造出来的路径充分拟合初始和终止位置、速度和加速度的路径，适应非结构化的环境。基于5次多项式构造路径有利于保证汽车行驶平稳性，原因在于这种路径加速度变化率最小。然而，若要保证规划出来的整条路径在速度、加速度、曲率和曲率变化率方面的有界性，该方法还需要不断调整时间区间。（这个直接构造法就是用固定时间区间，用多项式构造轨迹，然后优化时间的分配）

此外，针对结构化道路环境中的局部轨迹生成方法做出改进，计算道路中线的Frenet坐标下的坐标，可以适应各种道路环境下的局部轨迹生成问题。



==**路径-速度分解法：**==

在有移动障碍物的环境下，可以通过将运动规划拆分为避开静态障碍物与避开移动障碍物的过程。在构造一条路径避开静态障碍物的基础上，进行速度规划，以避开移动障碍物。





# 4.理解曲率

半径越小的，曲率越大

![image-20230812160317126](https://raw.githubusercontent.com/Howardcl/MyImage/main/img/202308121603166.png)

![image-20230812160354702](https://raw.githubusercontent.com/Howardcl/MyImage/main/img/202308121603747.png)

**3.1 密切圆**

可以将圆的曲率扩展到曲线上。我们知道两点决定一条直线，比如下面就是曲线的割线：![img](https://raw.githubusercontent.com/Howardcl/MyImage/main/img/202308121607171.png)

当$x->x_0$时，得到的就是切线，



![image-20230812160841546](/home/ubuntu22/.config/Typora/typora-user-images/image-20230812160841546.png)

曲率连续是什么意思呢？

是即使两个相邻段之间是平滑连接的，但是两个段具有不同或不同方向的曲率。大多数这样的光滑连接，其实际上是间断点（曲率不连续点）。在该类型的不连续点上，所有相关坐标轴都表现出加速度的不连续性。

==曲率不连续：就是指该点前后的曲率不同==

**拐点是什么**：

拐点是在2个相邻段之间的非光滑连接的点。在一个拐点处，速度矢量改变了它的方向。如果这个速度矢量非0，那么所有与该段轨迹相关的坐标轴在拐点处的速度均表现出不连续性。

## 4.2 曲率的计算方式

![image-20230812161226017](/home/ubuntu22/.config/Typora/typora-user-images/image-20230812161226017.png)

# 5.Reeds-Shepp曲线

## 5.1 简介

Reeds-Shepp 算法简称 RS，由 J.A.Reeds 和 L.A.Shepp 于 1990 年发表的论文 ( optimal path for a car that goes both forward and backwards)。该方法基于 Dubins 算法进行改进，将反向运动（汽车允许后退，挂倒挡）加入到规划中，这就使得在某些情况下可以得出比 Dubins 曲线更优的解。

曲线示例如下：![img](https://raw.githubusercontent.com/Howardcl/MyImage/main/img/202308121138722.gif)

如上图可以知道，在 **Reeds-Shepp** 曲线的路径中，允许尖瓣存在。

## 5.2 字段组合

在字段中的字母上加入上标，用来表示运动方向，表示如下：

| 符号 | 含义         | 绕单位圆 |
| ---- | ------------ | -------- |
| L+   | 向**前**左转 | 逆时针   |
| L−   | 向**后**左转 | 顺时针   |
| R+   | 向**前**右转 | 逆时针   |
| R−   | 向**后**右转 | 顺时针   |
| S+   | 向**前**直走 | /        |
| S−   | 向**后**直走 | /        |

![image-20230812114851125](https://raw.githubusercontent.com/Howardcl/MyImage/main/img/202308121148187.png)

# 6.NLP路径优化求解

# 7.DP动态规划

**全局路径规划算法——动态规划算法（含python实现）**

## 7.1 算法简介

动态规划是运筹学的一个分支，是求解多阶段决策过程最优化问题的数学方法。
各个阶段决策的选取不是任意确定的，它依赖于当前面临的状态，又影响以后的发展。当各个阶段的决策确定后，就组成了一个决策序列，因而也就决定了整个过程的一条活动路线，这样的一个前后关联具有链状结构的多阶段过程就称为多阶段决策问题。
动态规划在车辆工程技术领域有着广泛的应用，如“两档变速器最优换挡规律”、“混合动力汽车最优能量管理策略”、“栅格地图最优路径搜索”等。



==DP路径算法的基本思想：==

基于给定的一条中心路径（Reference Line），称为参考线，和车道边界条件，每隔一定间隔的纵向距离（称为不同级上的S值）对道路截面进行均匀采样，

## 8.2 算法思想

动态规划的思想就是将多阶段决策问题转化为一系列单阶段最优化问题。

对最佳路径（最佳决策过程）所经过的各个阶段，其中每个阶段始点到全过程终点的路径，必定是该阶段起始点到全
过程终点的一切可能路径中的最佳路径（最优决策），这就是Bellman提出的著名的最优化原理。

简言之， 一个最优策略的子策略必然也是最优的。

DP算法逆向寻优，正向求解，本质由三层循环构成：

1. 第一层遍历每一个阶段；
2. 第二层遍历第i ii个阶段的每一个状态；
3. 第三层循环遍历第i ii阶段的第j jj个状态到第i − 1 i-1i−1阶段的每一条路径， 更新当前状态的到上一个阶段的状态的最短距离





# 9.路径规划与速度规划

三维问题（道路+时间维度）分解为二维问题。

以百度Apollo中的EM规划算法为例，==其分别应用了动态规划算法进行路径规划，二次规划算法进行速度规划。==

这两者是递进关系。

当局部路径规划给出了一条或若干条选出的路径曲线之后，后续问题是在此局部路径的基础上加入与速度规划相关的信息，这一问题被称为速度规划。





## 9.2 速度规划常见的方法：

### （1）对路径指定线加速度来生成加速度：



### （2）样条插值：



### （3）函数拟合：



### （4）目标时刻点法：



### （5）QP算法（二次规划）



# 10.Frenet坐标系

# 11.Hybird A*：曲率不连续